"use strict";var e=require("../../common/vendor.js");Array||e.resolveComponent("uni-icons")();const b=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||b();const w={__name:"index",setup(p){const o=e.ref(""),c=e.ref([]),m=e.ref(e.dayjs().format("YYYY-MM-DD HH:mm:ss")),f=e.ref(0);e.ref();const s=e.ref([]),u=e.ref();e.ref();const d=e.ref(),h=e.ref(0),_=async()=>{if(o.value)await e.pn.callFunction({name:"happy",data:{api:"message",message:o.value,likeNum:f.value,createTime:m.value,nickName:s.value.nickName,avatarUrl:s.value.avatarUrl,status:h.value,token:e.index.getStorageSync("token")}}).then(n=>{i(),x(),o.value="",e.index.showToast({title:"\u7559\u8A00\u6210\u529F",icon:"success"})}).catch(n=>{console.log(n),e.index.showToast({title:"\u7559\u8A00\u5931\u8D25",icon:"error"})});else throw e.index.showToast({title:"\u7559\u8A00\u4E0D\u80FD\u4E3A\u7A7A",icon:"error"}),new Error("\u4E0D\u80FD\u4E3A\u7A7A")},i=n=>{e.pn.callFunction({name:"happy",data:{api:n||"getMessage",token:e.index.getStorageSync("token")}}).then(t=>{c.value=t.result.data}).catch(t=>{console.log(t),e.index.showToast({title:"\u83B7\u53D6\u7559\u8A00\u5931\u8D25",icon:"error"})})},k=async()=>{await e.index.login({timeout:1e4,success:n=>{u.value=n.code,console.log(n.code)},fail:n=>{console.log(n)}})},x=async()=>{const n=c.value.length;d.value="id-"+(n-1)},y=async(n,t,a)=>{t++,await e.pn.callFunction({name:"happy",data:{api:"updatelikes",likeNumber:t,id:n,token:e.index.getStorageSync("token")}}).then(r=>{e.index.showToast({title:"\u70B9\u8D5E\u6210\u529F",icon:"success"});const l=c.value.filter(v=>v._id==n);l[0].likeNumber++}).catch(r=>{e.index.showToast({title:"\u4F60\u5DF2\u7ECF\u70B9\u8FC7\u8D5E\u5566",icon:"error"})})},g=async()=>{await k();let n=e.index.getStorageSync("token");n?i():e.pn.callFunction({name:"happy",data:{api:"loginWithMp",nickName:s.value.nickName||"\u533F\u540D\u7528\u6237",avatarUrl:s.value.avatarUrl||"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-f7df76d0-0735-45ba-bd49-e366b3796e28/e89dbb99-fcd8-4182-ad73-82395d85bb9f.png",signature:s.value.signature||"0",code:u.value}}).then(({result:t})=>{n=t.token,e.index.setStorageSync("token",n),i()}).catch(t=>{e.index.showToast({title:"\u767B\u5F55\u5931\u8D25",icon:"error"})})};return e.onLoad(()=>{g()}),(n,t)=>({a:e.f(c.value,(a,r,l)=>({a:a.avatarUrl,b:e.t(a.nickName),c:e.t(a.message),d:e.t(a.createTime),e:"1e0064b8-0-"+l,f:e.t(a.likeNumber),g:e.o(v=>y(a._id,a.likeNumber)),h:a._id,i:"id-"+r})),b:e.p({type:"hand-up-filled",size:"14"}),c:d.value,d:e.o(a=>g()),e:o.value,f:e.o(a=>o.value=a.detail.value),g:e.o(a=>_())})}};var T=e._export_sfc(w,[["__file","/Users/huangqiang/Documents/HBuilderProjects/iihao/pages/index/index.vue"]]);wx.createPage(T);
