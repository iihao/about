"use strict";var e=require("../../common/vendor.js");Array||e.resolveComponent("uni-icons")();const x=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||x();const N={__name:"index",setup(m){const o=e.ref(""),l=e.ref([]),v=e.ref(0),g=e.ref(),s=e.ref(),c=e.ref(),t=e.ref(),r=e.ref();g.value=e.dayjs().format("YYYY-MM-DD HH:mm:ss");const d=async()=>{if(o.value)await e.rn.callFunction({name:"happy",data:{api:"message",message:o.value,likeNum:v.value,createTime:g.value,nickName:c.value,avatarUrl:t.value,token:e.index.getStorageSync("token")}}).then(a=>{u(),p(),o.value="",e.index.showToast({title:"\u7559\u8A00\u6210\u529F",icon:"success"})});else throw new Error("\u4E0D\u80FD\u4E3A\u7A7A")},u=a=>{e.rn.callFunction({name:"happy",data:{api:a||"getMessage",token:e.index.getStorageSync("token")}}).then(i=>{l.value=i.result.data})},f=()=>{e.index.getUserProfile({desc:"\u7528\u4E8E\u7559\u8A00",success:a=>{t.value=a.userInfo.avatarUrl,c.value=a.userInfo.nickName,console.log(a)},fail:a=>{console.log(a)}})},p=async()=>{const a=l.value.length;r.value="id-"+(a-1),console.log(r.value,"\u6EDA\u52A8")},_=()=>{e.rn.callFunction({name:"happy",data:{api:"updatelikes",likeNumber:v.value}})};e.onLoad(()=>{});const k=()=>{s.value=e.index.getStorageSync("token"),s.value?u():(f(),console.log("avatar",t.value),t.value&&c.value&&e.index.login().then(({code:a})=>{e.rn.callFunction({name:"happy",data:{api:"loginWithMp",nickName:c.value,avatarUrl:t.value,code:a}}).then(({result:i})=>{s=i.token,e.index.setStorageSync("token",s),u()})}))};return(a,i)=>({a:e.f(l.value,(n,h,y)=>({a:n.avatarUrl,b:e.t(n.nickName),c:e.t(n.message),d:e.t(n.createTime),e:"1e0064b8-0-"+y,f:e.t(n.likeNumber),g:n._id,h:"id-"+h})),b:e.p({type:"hand-up-filled",size:"14"}),c:e.o(_),d:r.value,e:e.o(n=>k()),f:o.value,g:e.o(n=>o.value=n.detail.value),h:e.o(n=>d())})}};var S=e._export_sfc(N,[["__file","/Users/huangqiang/Documents/HBuilderProjects/iihao/pages/index/index.vue"]]);wx.createPage(S);
