"use strict";var e=require("../../common/vendor.js");Array||e.resolveComponent("uni-icons")();const x=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||x();const S={__name:"index",setup(v){const o=e.ref(""),c=e.ref([]),u=e.ref(0),g=e.ref(),t=e.ref(),i=e.ref(),l=e.ref();g.value=e.dayjs().format("YYYY-MM-DD HH:mm:ss");const d=async()=>{if(o.value)await e.rn.callFunction({name:"happy",data:{api:"message",message:o.value,likeNum:u.value,createTime:g.value,nickName:t.value,avatarUrl:i.value,token:e.index.getStorageSync("token")}}).then(n=>{r(),p(),o.value="",e.index.showToast({title:"\u7559\u8A00\u6210\u529F",icon:"success"})});else throw new Error("\u4E0D\u80FD\u4E3A\u7A7A")},r=n=>{e.rn.callFunction({name:"happy",data:{api:n||"getMessage",token:e.index.getStorageSync("token")}}).then(s=>{c.value=s.result.data})},m=()=>{e.index.getUserProfile({desc:"\u7528\u4E8E\u7559\u8A00",success:n=>{i.value=n.userInfo.avatarUrl,t.value=n.userInfo.nickName,e.index.setStorageSync("avatarUrl",n.userInfo.avatarUrl),e.index.setStorageSync("nickName",n.userInfo.nickName),console.log(n)},fail:n=>{console.log(n)}})},f=()=>{t.value=e.index.getStorageSync("nickName"),i.value=e.index.getStorageSync("avatarUrl"),t.value?console.log(t.value):m()},p=async()=>{const n=c.value.length;l.value="id-"+(n-1),console.log(l.value,"\u6EDA\u52A8")},_=()=>{e.rn.callFunction({name:"happy",data:{api:"updatelikes",likeNumber:u.value}})};e.onLoad(()=>{k()});const k=()=>{const n=e.index.getStorageSync("token");n?r():e.index.login().then(({code:s})=>{e.rn.callFunction({name:"happy",data:{api:"loginWithMp",code:s}}).then(({result:a})=>{n=a.token,e.index.setStorageSync("token",n),r()})})};return(n,s)=>({a:e.f(c.value,(a,y,h)=>({a:a.avatarUrl,b:e.t(a.nickName),c:e.t(a.message),d:e.t(a.createTime),e:"1e0064b8-0-"+h,f:e.t(a.likeNumber),g:a._id,h:"id-"+y})),b:e.p({type:"hand-up-filled",size:"14"}),c:e.o(_),d:l.value,e:e.o(a=>f()),f:o.value,g:e.o(a=>o.value=a.detail.value),h:e.o(a=>d())})}};var N=e._export_sfc(S,[["__file","/Users/huangqiang/Documents/HBuilderProjects/iihao/pages/index/index.vue"]]);wx.createPage(N);
